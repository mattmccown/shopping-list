<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ðŸ›’ Shopping List</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; max-width: 500px; margin: 0 auto; background: #f5f5f5; }
    h1 { color: #333; text-align: center; }
    .store-section { margin: 25px 0; padding: 15px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .store-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
    .store-icon { font-size: 24px; }
    .store-name { font-size: 18px; font-weight: bold; color: #333; }
    .item { display: flex; align-items: center; background: #fafafa; padding: 10px 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #eee; }
    .item.checked { background: #e8f5e9; text-decoration: line-through; opacity: 0.6; }
    .item input { width: 22px; height: 22px; margin-right: 12px; }
    .item-name { flex: 1; font-size: 15px; }
    .item-category { font-size: 12px; color: #888; background: #eee; padding: 2px 8px; border-radius: 4px; margin-right: 8px; }
    .remove { color: #ff6b6b; cursor: pointer; font-size: 18px; }
    .add-form { background: white; padding: 20px; border-radius: 12px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .add-form input, .add-form select { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 6px; }
    .add-form .row { display: flex; gap: 5px; }
    .add-form button { width: 100%; padding: 12px; background: #4a90d9; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px; }
    .stats { text-align: center; color: #666; margin-top: 20px; padding: 15px; background: white; border-radius: 8px; }
    .store-filter { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 10px; }
    .store-filter button { padding: 8px 16px; border: none; background: #e0e0e0; border-radius: 20px; cursor: pointer; white-space: nowrap; }
    .store-filter button.active { background: #4a90d9; color: white; }
  </style>
</head>
<body>
  <h1>ðŸ›’ Shopping List</h1>
  
  <div class="store-filter">
    <button class="active" onclick="filterStore('all')">All Stores</button>
    <button onclick="filterStore('Dierbergs')">Dierbergs</button>
    <button onclick="filterStore('Target')">Target</button>
    <button onclick="filterStore('Sam\'s Club')">Sam's Club</button>
  </div>
  
  <div id="list"></div>
  
  <div class="add-form">
    <h3>âž• Add Item</h3>
    <input type="text" id="newItem" placeholder="Item name" style="width: 100%; box-sizing: border-box;">
    <div class="row">
      <select id="newCategory" style="flex:1;">
        <option value="Produce">Produce</option>
        <option value="Dairy">Dairy</option>
        <option value="Meat">Meat</option>
        <option value="Pantry">Pantry</option>
        <option value="Frozen">Frozen</option>
        <option value="Bakery">Bakery</option>
        <option value="Other">Other</option>
      </select>
      <select id="newStore" style="flex:1;">
        <option value="Dierbergs">Dierbergs</option>
        <option value="Target">Target</option>
        <option value="Sam's Club">Sam's Club</option>
        <option value="Whole Foods">Whole Foods</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <button onclick="addItem()">Add Item</button>
  </div>
  
  <div class="stats">
    <span id="checkedCount">0</span> of <span id="totalCount">0</span> items checked
  </div>

  <script>
    const stores = {
      'Dierbergs': 'ðŸª',
      'Target': 'ðŸŽ¯',
      'Sam\'s Club': 'ðŸ“¦',
      'Whole Foods': 'ðŸŒ¿',
      'Other': 'ðŸ·ï¸'
    };
    
    // Load from JSON (shared) or fallback to localStorage
    async function loadItems() {
      try {
        const r = await fetch('items.json');
        items = await r.json();
      } catch(e) {
        items = JSON.parse(localStorage.getItem('shoppingList')) || [];
      }
      renderItems();
    }
    loadItems();
    
    let currentFilter = 'all';
    
    function save() {
      localStorage.setItem('shoppingList', JSON.stringify(items));
      render();
    }
    
    function toggle(id) {
      const item = items.find(i => i.id === id);
      if (item) {
        item.checked = !item.checked;
        save();
      }
    }
    
    function remove(id) {
      items = items.filter(i => i.id !== id);
      save();
    }
    
    function addItem() {
      const input = document.getElementById('newItem');
      const category = document.getElementById('newCategory').value;
      const store = document.getElementById('newStore').value;
      if (input.value.trim()) {
        items.push({
          id: Date.now(),
          text: input.value.trim(),
          category: category,
          store: store,
          checked: false
        });
        input.value = '';
        save();
      }
    }
    
    function filterStore(store) {
      currentFilter = store;
      document.querySelectorAll('.store-filter button').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      render();
    }
    
    function render() {
      const list = document.getElementById('list');
      let html = '';
      
      const filteredItems = currentFilter === 'all' ? items : items.filter(i => i.store === currentFilter);
      
      // Group by store, then sort by category within each store
      const categoryOrder = ['Produce', 'Dairy', 'Meat', 'Bakery', 'Frozen', 'Pantry', 'Other'];
      
      Object.keys(stores).forEach(store => {
        const storeItems = filteredItems.filter(i => i.store === store);
        // Sort by category order, then by name
        storeItems.sort((a, b) => {
          const aIdx = categoryOrder.indexOf(a.category);
          const bIdx = categoryOrder.indexOf(b.category);
          if (aIdx !== bIdx) return aIdx - bIdx;
          return a.text.localeCompare(b.text);
        });
        if (storeItems.length > 0) {
          html += `<div class="store-section">
            <div class="store-header">
              <span class="store-icon">${stores[store]}</span>
              <span class="store-name">${store}</span>
            </div>`;
          storeItems.forEach(item => {
            html += `
              <div class="item ${item.checked ? 'checked' : ''}">
                <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggle(${item.id})">
                <span class="item-name">${item.text}</span>
                <span class="item-category">${item.category}</span>
                <span class="remove" onclick="remove(${item.id})">ðŸ‘Ž</span>
              </div>
            `;
          });
          html += '</div>';
        }
      });
      
      list.innerHTML = html || '<p style="text-align:center;color:#999;">No items yet</p>';
      
      const checked = items.filter(i => i.checked).length;
      document.getElementById('checkedCount').textContent = checked;
      document.getElementById('totalCount').textContent = items.length;
    }
    
    render();
  </script>
</body>
</html>
